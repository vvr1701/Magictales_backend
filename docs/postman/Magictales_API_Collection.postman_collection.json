{
  "info": {
    "name": "Magictales API - Complete Testing Collection",
    "description": "Comprehensive collection for testing the Magictales PDF generation API with complete flow from photo upload to PDF download.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "magictales-api-collection",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    }
  },
  "auth": {
    "type": "noauth"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('üöÄ Making request to:', pm.request.url);",
          "",
          "// Set timestamp for session tracking",
          "pm.globals.set('timestamp', new Date().toISOString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test('Response time is reasonable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(30000);",
          "});",
          "",
          "pm.test('Content-Type is correct', function () {",
          "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "});"
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000",
      "type": "string"
    },
    {
      "key": "photo_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "photo_url",
      "value": "",
      "type": "string"
    },
    {
      "key": "job_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "preview_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "order_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "session_id",
      "value": "test-session-{{$timestamp}}",
      "type": "string"
    },
    {
      "key": "test_child_name",
      "value": "Emma",
      "type": "string"
    },
    {
      "key": "test_child_age",
      "value": "6",
      "type": "string"
    },
    {
      "key": "test_child_gender",
      "value": "female",
      "type": "string"
    },
    {
      "key": "test_theme",
      "value": "magic_castle",
      "type": "string"
    },
    {
      "key": "test_email",
      "value": "test@magictales.com",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üè• Health & Info",
      "description": "Health check and development info endpoints",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "health"
              ]
            },
            "description": "Check if the API server is running and healthy"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Health check returns 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Service is healthy', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.status).to.eql('healthy');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Development Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/dev/info",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "dev",
                "info"
              ]
            },
            "description": "Get information about available development endpoints and testing flow"
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Dev info returns 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Contains service info', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.service).to.include('Magictales');",
                  "    pm.expect(response.available_endpoints).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üì∏ 1. Upload Photo",
      "description": "Photo upload and validation",
      "item": [
        {
          "name": "Upload Child Photo",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "photo",
                  "type": "file",
                  "src": "",
                  "description": "Child's photo file (JPEG/PNG, max 10MB)"
                },
                {
                  "key": "session_id",
                  "value": "{{session_id}}",
                  "type": "text",
                  "description": "Optional session identifier"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/api/upload-photo",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "upload-photo"
              ]
            },
            "description": "Upload a child's photo for face validation and processing. The photo must contain exactly one clearly visible child's face."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "photo",
                      "type": "file",
                      "src": ""
                    },
                    {
                      "key": "session_id",
                      "value": "test-session-123",
                      "type": "text"
                    }
                  ]
                },
                "url": {
                  "raw": "{{baseUrl}}/api/upload-photo",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "upload-photo"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"photo_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"photo_url\": \"https://storage.example.com/uploads/550e8400-e29b-41d4-a716-446655440000/photo.jpg\",\n    \"face_valid\": true,\n    \"face_count\": 1\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üì∏ Uploading child photo...');",
                  "console.log('Session ID:', pm.variables.get('session_id'));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Photo upload successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains required fields', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('photo_id');",
                  "    pm.expect(response).to.have.property('photo_url');",
                  "    pm.expect(response).to.have.property('face_valid');",
                  "    pm.expect(response).to.have.property('face_count');",
                  "});",
                  "",
                  "pm.test('Face validation passed', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.face_valid).to.be.true;",
                  "    pm.expect(response.face_count).to.be.at.least(1);",
                  "});",
                  "",
                  "// Store photo details for next requests",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('photo_id', response.photo_id);",
                  "    pm.collectionVariables.set('photo_url', response.photo_url);",
                  "    console.log('‚úÖ Photo uploaded successfully! ID:', response.photo_id);",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üé® 2. Create Preview",
      "description": "Preview generation requests",
      "item": [
        {
          "name": "Create Storybook Preview",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"photo_url\": \"{{photo_url}}\",\n    \"child_name\": \"{{test_child_name}}\",\n    \"child_age\": {{test_child_age}},\n    \"child_gender\": \"{{test_child_gender}}\",\n    \"theme\": \"{{test_theme}}\",\n    \"style\": \"artistic\",\n    \"session_id\": \"{{session_id}}\",\n    \"customer_email\": \"{{test_email}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/preview",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "preview"
              ]
            },
            "description": "Create a new storybook preview with personalized images. This starts the AI generation process."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"photo_url\": \"https://storage.example.com/photo.jpg\",\n    \"child_name\": \"Emma\",\n    \"child_age\": 6,\n    \"child_gender\": \"female\",\n    \"theme\": \"magic_castle\",\n    \"style\": \"artistic\",\n    \"session_id\": \"test-session-123\",\n    \"customer_email\": \"test@example.com\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/api/preview",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "preview"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"job_id\": \"job-550e8400-e29b-41d4-a716-446655440001\",\n    \"preview_id\": \"preview-550e8400-e29b-41d4-a716-446655440002\",\n    \"status\": \"queued\",\n    \"estimated_time_seconds\": 180,\n    \"message\": \"Your personalized storybook is being generated...\"\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üé® Creating storybook preview...');",
                  "console.log('Child name:', pm.variables.get('test_child_name'));",
                  "console.log('Theme:', pm.variables.get('test_theme'));",
                  "",
                  "// Ensure we have a photo URL from previous step",
                  "const photoUrl = pm.collectionVariables.get('photo_url');",
                  "if (!photoUrl) {",
                  "    console.warn('‚ö†Ô∏è No photo_url found. Please upload a photo first.');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Preview creation successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains job details', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('job_id');",
                  "    pm.expect(response).to.have.property('preview_id');",
                  "    pm.expect(response).to.have.property('status');",
                  "    pm.expect(response).to.have.property('estimated_time_seconds');",
                  "});",
                  "",
                  "pm.test('Job is queued', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.status).to.eql('queued');",
                  "});",
                  "",
                  "// Store job details for status polling",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('job_id', response.job_id);",
                  "    pm.collectionVariables.set('preview_id', response.preview_id);",
                  "    console.log('‚úÖ Preview generation started! Job ID:', response.job_id);",
                  "    console.log('üìã Preview ID:', response.preview_id);",
                  "    console.log('‚è±Ô∏è Estimated time:', response.estimated_time_seconds, 'seconds');",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "‚è≥ 3. Check Preview Status",
      "description": "Monitor preview generation progress",
      "item": [
        {
          "name": "Get Preview Generation Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/preview-status/{{job_id}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "preview-status",
                "{{job_id}}"
              ]
            },
            "description": "Check the status of preview generation. Poll this endpoint until status is 'completed'."
          },
          "response": [
            {
              "name": "Processing",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/preview-status/job-123",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "preview-status",
                    "job-123"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"job_id\": \"job-123\",\n    \"status\": \"processing\",\n    \"progress\": 45,\n    \"current_step\": \"Generating page 3 of 10\",\n    \"preview_id\": \"preview-456\",\n    \"redirect_url\": null,\n    \"error\": null,\n    \"can_retry\": false\n}"
            },
            {
              "name": "Completed",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/preview-status/job-123",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "preview-status",
                    "job-123"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"job_id\": \"job-123\",\n    \"status\": \"completed\",\n    \"progress\": 100,\n    \"current_step\": \"Preview ready\",\n    \"preview_id\": \"preview-456\",\n    \"redirect_url\": \"/preview/preview-456\",\n    \"error\": null,\n    \"can_retry\": false\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('‚è≥ Checking preview generation status...');",
                  "console.log('Job ID:', pm.collectionVariables.get('job_id'));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status check successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains status info', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('job_id');",
                  "    pm.expect(response).to.have.property('status');",
                  "    pm.expect(response).to.have.property('progress');",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "console.log('üìä Status:', response.status);",
                  "console.log('üìà Progress:', response.progress + '%');",
                  "",
                  "if (response.current_step) {",
                  "    console.log('üîÑ Current step:', response.current_step);",
                  "}",
                  "",
                  "if (response.status === 'completed') {",
                  "    console.log('‚úÖ Preview generation completed!');",
                  "    if (response.redirect_url) {",
                  "        console.log('üîó Preview URL:', response.redirect_url);",
                  "    }",
                  "} else if (response.status === 'failed') {",
                  "    console.log('‚ùå Preview generation failed:', response.error);",
                  "} else {",
                  "    console.log('‚åõ Still processing... Poll again in a few seconds');",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üîß 4. [DEV] Generate PDF",
      "description": "Development PDF generation (bypasses payment)",
      "item": [
        {
          "name": "Generate PDF (Development)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"preview_id\": \"{{preview_id}}\",\n    \"customer_email\": \"{{test_email}}\",\n    \"customer_name\": \"Test Customer\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/dev/generate-pdf",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "dev",
                "generate-pdf"
              ]
            },
            "description": "‚ö†Ô∏è DEVELOPMENT ONLY: Generate PDF without payment verification. Use only for testing purposes."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"preview_id\": \"preview-456\",\n    \"customer_email\": \"test@example.com\",\n    \"customer_name\": \"Test Customer\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/api/dev/generate-pdf",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "dev",
                    "generate-pdf"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"order_id\": \"DEV-A1B2C3D4E5F6G7H8\",\n    \"preview_id\": \"preview-456\",\n    \"message\": \"PDF generation started. Use order_id to track progress.\"\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üîß Starting PDF generation (DEV mode)...');",
                  "console.log('Preview ID:', pm.collectionVariables.get('preview_id'));",
                  "",
                  "// Ensure we have a preview ID from previous steps",
                  "const previewId = pm.collectionVariables.get('preview_id');",
                  "if (!previewId) {",
                  "    console.warn('‚ö†Ô∏è No preview_id found. Please create a preview first.');",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('PDF generation request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains order details', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('success');",
                  "    pm.expect(response).to.have.property('order_id');",
                  "    pm.expect(response).to.have.property('preview_id');",
                  "    pm.expect(response).to.have.property('message');",
                  "});",
                  "",
                  "pm.test('PDF generation started successfully', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.true;",
                  "});",
                  "",
                  "// Store order ID for status checking",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('order_id', response.order_id);",
                  "    console.log('‚úÖ PDF generation started! Order ID:', response.order_id);",
                  "    console.log('üìã Message:', response.message);",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üìä 5. Check Order Status",
      "description": "Monitor PDF generation progress",
      "item": [
        {
          "name": "Get Order Status (Development)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/dev/order-status/{{order_id}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "dev",
                "order-status",
                "{{order_id}}"
              ]
            },
            "description": "Check the status of PDF generation and order processing."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/dev/order-status/DEV-A1B2C3D4E5F6G7H8",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "dev",
                    "order-status",
                    "DEV-A1B2C3D4E5F6G7H8"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"success\": true,\n    \"order\": {\n        \"order_id\": \"DEV-A1B2C3D4E5F6G7H8\",\n        \"preview_id\": \"preview-456\",\n        \"status\": \"completed\",\n        \"created_at\": \"2024-01-15T10:30:00Z\",\n        \"customer_email\": \"test@example.com\",\n        \"is_development_order\": true\n    },\n    \"preview\": {\n        \"status\": \"purchased\",\n        \"expires_at\": \"2024-01-22T10:30:00Z\"\n    }\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üìä Checking order status...');",
                  "console.log('Order ID:', pm.collectionVariables.get('order_id'));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Order status check successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response contains order and preview info', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('success');",
                  "    pm.expect(response).to.have.property('order');",
                  "    pm.expect(response).to.have.property('preview');",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "console.log('üìã Order Status:', response.order.status);",
                  "console.log('üé® Preview Status:', response.preview.status);",
                  "console.log('üîß Development Order:', response.order.is_development_order);",
                  "",
                  "if (response.order.status === 'completed') {",
                  "    console.log('‚úÖ PDF generation completed! Ready for download.');",
                  "} else {",
                  "    console.log('‚åõ PDF still being generated...');",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üì• 6. Download PDF",
      "description": "Download the generated PDF",
      "item": [
        {
          "name": "Download Generated PDF",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/download/{{order_id}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "download",
                "{{order_id}}"
              ]
            },
            "description": "Download the final PDF storybook. Only available after PDF generation is completed."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/download/DEV-A1B2C3D4E5F6G7H8",
                  "host": [
                    "{{baseUrl}}"
                  ],
                  "path": [
                    "api",
                    "download",
                    "DEV-A1B2C3D4E5F6G7H8"
                  ]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n    \"status\": \"ready\",\n    \"downloads\": {\n        \"pdf\": {\n            \"url\": \"https://storage.example.com/downloads/signed-url\",\n            \"filename\": \"Emma-Magic-Castle-Storybook.pdf\",\n            \"size_mb\": 15.2,\n            \"expires_in_seconds\": 3600\n        }\n    },\n    \"expires_at\": \"2024-01-22T10:30:00Z\",\n    \"days_remaining\": 5\n}"
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üì• Downloading PDF...');",
                  "console.log('Order ID:', pm.collectionVariables.get('order_id'));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Download request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "const response = pm.response.json();",
                  "",
                  "if (response.status === 'ready') {",
                  "    pm.test('PDF is ready for download', function () {",
                  "        pm.expect(response).to.have.property('downloads');",
                  "        pm.expect(response.downloads).to.have.property('pdf');",
                  "        pm.expect(response.downloads.pdf).to.have.property('url');",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ PDF is ready for download!');",
                  "    console.log('üìÑ Filename:', response.downloads.pdf.filename);",
                  "    console.log('üìä Size:', response.downloads.pdf.size_mb, 'MB');",
                  "    console.log('üîó Download URL:', response.downloads.pdf.url);",
                  "    console.log('‚è∞ Link expires in:', response.downloads.pdf.expires_in_seconds, 'seconds');",
                  "} else {",
                  "    console.log('‚åõ PDF not ready yet. Status:', response.status);",
                  "    if (response.progress) {",
                  "        console.log('üìà Progress:', response.progress + '%');",
                  "    }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üß™ Complete Flow Tester",
      "description": "Automated test runner for the complete flow",
      "item": [
        {
          "name": "Run Complete API Flow Test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"note\": \"This is a placeholder request for manual flow testing\",\n    \"instructions\": [\n        \"1. Upload a photo using the Upload Photo request\",\n        \"2. Create a preview using the Create Preview request\",\n        \"3. Poll the Preview Status until completed\",\n        \"4. Generate PDF using the DEV Generate PDF request\",\n        \"5. Check Order Status until completed\",\n        \"6. Download the final PDF\"\n    ],\n    \"test_data\": {\n        \"child_name\": \"{{test_child_name}}\",\n        \"child_age\": \"{{test_child_age}}\",\n        \"theme\": \"{{test_theme}}\",\n        \"email\": \"{{test_email}}\"\n    }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/dev/info",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "dev",
                "info"
              ]
            },
            "description": "This request serves as a checklist for running the complete API flow. Follow the instructions in the request body to test the entire pipeline."
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "console.log('üß™ Complete Flow Test Checklist:');",
                  "console.log('================================');",
                  "console.log('1. üì∏ Upload Photo: POST /api/upload-photo');",
                  "console.log('2. üé® Create Preview: POST /api/preview');",
                  "console.log('3. ‚è≥ Check Status: GET /api/preview-status/{job_id}');",
                  "console.log('4. üîß Generate PDF: POST /api/dev/generate-pdf');",
                  "console.log('5. üìä Check Order: GET /api/dev/order-status/{order_id}');",
                  "console.log('6. üì• Download PDF: GET /api/download/{order_id}');",
                  "console.log('================================');",
                  "",
                  "console.log('Current Variables:');",
                  "console.log('- Photo ID:', pm.collectionVariables.get('photo_id'));",
                  "console.log('- Photo URL:', pm.collectionVariables.get('photo_url'));",
                  "console.log('- Job ID:', pm.collectionVariables.get('job_id'));",
                  "console.log('- Preview ID:', pm.collectionVariables.get('preview_id'));",
                  "console.log('- Order ID:', pm.collectionVariables.get('order_id'));"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Flow tester info retrieved', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "console.log('‚úÖ Use the individual requests in order to test the complete flow.');",
                  "console.log('üìã Check collection variables to track progress between requests.');"
                ]
              }
            }
          ]
        }
      ]
    }
  ]
}