<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{child_name}}'s Storybook</title>

    <!-- Google Fonts (matches StoryGift fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Inline critical CSS (removed Tailwind CDN for offline reliability) -->

    <style>
        /* Custom CSS Variables (matches StoryGift) */
        :root {
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Inter', sans-serif;
        }

        /* Page styling for PDF generation (10x10 inch square) */
        .story-page {
            width: 10in;
            height: 10in;
            margin: 0;
            padding: 0;
            background: white;
            box-shadow: 0 0 0;
            border-radius: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            page-break-after: always;
            position: relative;
        }

        /* Image area - 80% of page height */
        .image-section {
            width: 100%;
            height: 80%;
            position: relative;
            background-color: #f3f4f6;
        }

        /* Text area - 20% of page height */
        .text-section {
            width: 100%;
            height: 20%;
            padding: 24px 32px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Image styling */
        .story-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Dialogue bubble styling (matches StoryGift) */
        .dialogue-bubble {
            position: absolute;
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.9);
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.4);
            max-width: 288px;
            z-index: 10;
        }

        /* Dialogue positioning */
        .dialogue-left {
            top: 20%;
            left: 5%;
            border-bottom-left-radius: 4px;
        }

        .dialogue-right {
            top: 20%;
            right: 5%;
            border-bottom-right-radius: 4px;
        }

        .dialogue-bottom {
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Speaker label styling */
        .speaker-label {
            display: block;
            font-size: 9px;
            font-weight: 900;
            letter-spacing: 0.15em;
            color: #1e40af;
            text-transform: uppercase;
            margin-bottom: 2px;
            opacity: 0.7;
        }

        /* Dialogue text styling */
        .dialogue-text {
            font-size: 14px;
            font-weight: 700;
            color: black;
            line-height: 1.3;
            margin: 0;
        }

        /* Story text styling */
        .story-text {
            font-family: var(--font-serif);
            font-size: 20px;
            font-weight: 400;
            color: #374151;
            line-height: 1.6;
            max-width: 80%;
        }

        /* Cover page specific styling */
        .cover-page {
            width: 10in;
            height: 10in;
            margin: 0;
            padding: 0;
            position: relative;
            background-size: cover;
            background-position: center;
            page-break-after: always;
        }

        /* Cover title overlay */
        .cover-title-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 33%;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.6), transparent);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 80px;
        }

        /* Cover title styling */
        .cover-title {
            background: linear-gradient(to bottom, #fde68a, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-family: var(--font-serif);
            font-weight: 900;
            font-size: 56px;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-align: center;
            padding: 0 32px;
            border-bottom: 2px solid rgba(245, 158, 11, 0.5);
            padding-bottom: 16px;
            text-shadow: 0 4px 4px rgba(0, 0, 0, 1);
        }

        /* Cover credits overlay */
        .cover-credits-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 48px;
        }

        /* Cover credits styling */
        .cover-credits {
            text-align: center;
            color: white;
        }

        .starring-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            font-weight: 300;
            margin-bottom: 8px;
        }

        .child-name {
            color: white;
            font-family: var(--font-sans);
            font-weight: 700;
            font-size: 32px;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 2px rgba(0, 0, 0, 0.8);
        }

        @media print {
            body { margin: 0; padding: 0; }
            .story-page, .cover-page { box-shadow: none; }
        }
    </style>
</head>
<body class="bg-black text-white font-sans" style="margin: 0; padding: 0;">

    <!-- COVER PAGE -->
    {% if cover_image_url %}
    <div class="cover-page" style="background-image: url('{{cover_image_url}}');">
        <!-- Title Overlay -->
        <div class="cover-title-overlay">
            <h1 class="cover-title">{{story_title}}</h1>
        </div>

        <!-- Credits Overlay -->
        <div class="cover-credits-overlay">
            <div class="cover-credits">
                <p class="starring-label">STARRING</p>
                <h2 class="child-name">{{child_name.upper()}}</h2>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- STORY PAGES -->
    {% for page in pages %}
    <div class="story-page">
        <!-- Image Section (80% of page) -->
        <div class="image-section">
            {% if page.image_url %}
            <img src="{{page.image_url}}" class="story-image" alt="Scene {{page.page_number}}" crossorigin="anonymous">
            {% endif %}

            <!-- Dialogue Bubbles -->
            {% for dialogue in page.dialogue %}
            <div class="dialogue-bubble dialogue-{{dialogue.position}}">
                <span class="speaker-label">{{dialogue.speaker}}</span>
                <p class="dialogue-text">"{{dialogue.text}}"</p>
            </div>
            {% endfor %}
        </div>

        <!-- Text Section (20% of page) -->
        <div class="text-section">
            {% if page.story_text %}
            <p class="story-text">{{page.story_text}}</p>
            {% else %}
            <!-- Visual spacer for pages without narrative -->
            <p style="font-size: 14px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.15em;">
                • • •
            </p>
            {% endif %}
        </div>
    </div>
    {% endfor %}

</body>
</html>